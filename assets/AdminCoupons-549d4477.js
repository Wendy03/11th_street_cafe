import{m as $,A as x}from"./modalMixin-4066d2fc.js";import{_ as M,o as c,c as u,a as e,t as p,k as r,v as h,z as k,e as V,d as v,r as b,b as g,F as D,p as L}from"./index-f76f9e83.js";import{T as m}from"./Toast-87810d29.js";const T={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{},tempCoupon:{},due_date:""}},mixins:[$],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{}},A={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog",role:"document"},U={class:"modal-content"},E={class:"modal-header bg-black text-white"},B={class:"modal-title",id:"exampleModalLabel"},I=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},S={class:"mb-3"},j=e("label",{for:"title"},"標題",-1),F={class:"mb-3"},H=e("label",{for:"coupon_code"},"優惠碼",-1),R={class:"mb-3"},z=e("label",{for:"due_date"},"到期日",-1),q={class:"mb-3"},G=e("label",{for:"price"},"折扣百分比",-1),J={class:"mb-3"},K={class:"form-check"},Q=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),W={class:"modal-footer"},X=e("button",{type:"button",class:"btn btn-gray","data-bs-dismiss":"modal"}," Close ",-1),Y=["disabled"],Z={key:0,class:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"};function ee(s,o,n,l,t,a){return c(),u("div",A,[e("div",N,[e("div",U,[e("div",E,[e("h5",B,[e("span",null,p(n.isNew?"新增優惠卷":"編輯優惠卷"),1)]),I]),e("div",O,[e("div",S,[j,r(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=i=>t.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[h,t.tempCoupon.title]])]),e("div",F,[H,r(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=i=>t.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[h,t.tempCoupon.code]])]),e("div",R,[z,r(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=i=>t.due_date=i)},null,512),[[h,t.due_date]])]),e("div",q,[G,r(e("input",{type:"number",class:"form-control",id:"price",min:"0",max:"100","onUpdate:modelValue":o[3]||(o[3]=i=>t.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[h,t.tempCoupon.percent,void 0,{number:!0}]])]),e("div",J,[e("div",K,[r(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=i=>t.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[k,t.tempCoupon.is_enabled]]),Q])])]),e("div",W,[X,e("button",{type:"button",class:"btn btn-dark",disabled:n.isProcessing,onClick:o[5]||(o[5]=i=>s.$emit("update-coupon",t.tempCoupon))},[n.isProcessing?(c(),u("span",Z)):V("",!0),v(" "+p(n.isNew?"新增優惠卷":"更新優惠券"),1)],8,Y)])])])],512)}const oe=M(T,[["render",ee]]),te={props:{coupon:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{}}},mixins:[$]},se={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},ne={class:"modal-dialog"},ie={class:"modal-content border-0"},le=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除優惠卷")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ae={class:"modal-body"},de={class:"text-danger"},ce={class:"modal-footer"},ue=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),pe=["disabled"];function re(s,o,n,l,t,a){return c(),u("div",se,[e("div",ne,[e("div",ie,[le,e("div",ae,[v(" 是否刪除 "),e("strong",de,p(n.coupon.title),1),v(" 優惠卷(刪除後將無法恢復)。 ")]),e("div",ce,[ue,e("button",{type:"button",class:"btn btn-danger",disabled:n.isProcessing,onClick:o[0]||(o[0]=i=>s.$emit("del-coupon"))}," 確認刪除 ",8,pe)])])])],512)}const me=M(te,[["render",re]]),{VITE_API:f,VITE_PATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/11th_street_cafe/",MODE:"production",DEV:!1,PROD:!0},_e={data(){return{coupons:[],tempCoupon:{},couponDate:"",pagination:{},isNew:!1,isLoading:!1,isProcessing:!1}},components:{AdminPagination:x,CouponModal:oe,DelCouponModal:me},methods:{getCoupons(s=1){this.isLoading=!0,this.$http.get(`${f}/api/${C}/admin/coupons?page=${s}`).then(o=>{const{coupons:n,pagination:l}=o.data;this.isLoading=!1,this.coupons=n,this.pagination=l}).catch(o=>{var l,t;const n=((t=(l=o.response)==null?void 0:l.data)==null?void 0:t.message)||"資料錯誤，稍後在試";this.isLoading=!1,m.fire({title:`${n}`,icon:"error"})})},openModal(s,o){s==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.$refs.couponModal.showModal()):s==="edit"?(this.tempCoupon={...o},this.$refs.couponModal.showModal()):s==="del"&&(this.tempCoupon={...o},this.$refs.delCouponModal.showModal())},updateCoupon(s){let o=s,n="post",l=`${f}/api/${C}/admin/coupon`;this.isNew||(n="put",l=`${f}/api/${C}/admin/coupon/${this.tempCoupon.id}`,o=this.tempCoupon),this.isProcessing=!0,this.$http[n](l,{data:o}).then(t=>{m.fire({title:`${t.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.couponModal.hideModal(),this.getCoupons()}).catch(t=>{var i,_;this.isProcessing=!1;const a=((_=(i=t.response)==null?void 0:i.data)==null?void 0:_.message)||"資料錯誤";m.fire({title:`${a}`,icon:"error"})})},delCoupon(){this.isProcessing=!0,this.$http.delete(`${f}/api/${C}/admin/coupon/${this.tempCoupon.id}`).then(s=>{m.fire({title:`${s.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.delCouponModal.hideModal(),this.getCoupons()}).catch(s=>{var n,l;this.isProcessing=!1;const o=((l=(n=s.response)==null?void 0:n.data)==null?void 0:l.message)||"資料錯誤";m.fire({title:`${o}`,icon:"error"})})}},mounted(){this.getCoupons()}},he={class:"text-end mt-4"},be=["disabled"],ge={class:"table-responsive-lg"},fe={class:"table mt-4"},Ce=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),ve={key:0,class:"text-success"},Me={key:1,class:"text-muted"},$e={class:"btn-group"},ye=["onClick"],Pe=["onClick"];function we(s,o,n,l,t,a){const i=b("VueLoading"),_=b("AdminPagination"),y=b("CouponModal"),P=b("DelCouponModal");return c(),u("div",null,[g(i,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=d=>t.isLoading=d)},null,8,["active"]),e("div",he,[e("button",{class:"btn btn-dark",type:"button",disabled:t.isProcessing,onClick:o[1]||(o[1]=d=>a.openModal("new"))}," 建立新的優惠券 ",8,be)]),e("div",ge,[e("table",fe,[Ce,e("tbody",null,[(c(!0),u(D,null,L(t.coupons,d=>(c(),u("tr",{key:d.id},[e("td",null,p(d.title),1),e("td",null,p(d.percent)+"%",1),e("td",null,p(s.$filters.date(d.due_date)),1),e("td",null,[d.is_enabled===1?(c(),u("span",ve,"啟用")):(c(),u("span",Me,"未啟用"))]),e("td",null,[e("div",$e,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal("edit",d)}," 編輯 ",8,ye),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal("del",d)}," 刪除 ",8,Pe)])])]))),128))])]),g(_,{pages:t.pagination,onChangePage:a.getCoupons},null,8,["pages","onChangePage"]),g(y,{ref:"couponModal",coupon:t.tempCoupon,"is-new":t.isNew,"is-processing":t.isProcessing,onUpdateCoupon:a.updateCoupon},null,8,["coupon","is-new","is-processing","onUpdateCoupon"]),g(P,{ref:"delCouponModal",coupon:t.tempCoupon,"is-processing":t.isProcessing,onDelCoupon:a.delCoupon},null,8,["coupon","is-processing","onDelCoupon"])])])}const De=M(_e,[["render",we]]);export{De as default};
