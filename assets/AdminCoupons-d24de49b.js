import{m as P,A as V}from"./modalMixin-538e6ada.js";import{_ as $,r as m,o as r,c as p,a as e,t as h,b as a,w as x,u as v,l as y,v as k,B as D,e as L,d as M,F as T,s as N}from"./index-ff8ae3b9.js";import{T as b}from"./Toast-3d07b7ec.js";import"./base-component-0116f244.js";const A={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{},tempCoupon:{},due_date:""}},mixins:[P],watch:{coupon(){this.tempCoupon=this.coupon;const n=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=n},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{}},E={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog",role:"document"},B={class:"modal-content"},I={class:"modal-header bg-black text-white"},F={class:"modal-title",id:"exampleModalLabel"},O=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),S={class:"modal-body"},q={class:"mb-3"},j=e("label",{for:"title"},"標題",-1),H={class:"mb-3"},R=e("label",{for:"coupon_code"},"優惠碼",-1),z={class:"mb-3"},G=e("label",{for:"due_date"},"到期日",-1),J={class:"mb-3"},K=e("label",{for:"price"},"折扣百分比",-1),Q={class:"mb-3"},W={class:"form-check"},X=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Y={class:"modal-footer"},Z=e("button",{type:"button",class:"btn btn-gray","data-bs-dismiss":"modal"}," Close ",-1),ee=["disabled"],oe={key:0,class:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"};function se(n,o,i,l,s,d){const c=m("VField"),u=m("ErrorMessage"),C=m("VForm");return r(),p("div",E,[e("div",U,[e("div",B,[e("div",I,[e("h5",F,[e("span",null,h(i.isNew?"新增優惠卷":"編輯優惠卷"),1)]),O]),a(C,{ref:"form",onSubmit:o[5]||(o[5]=_=>n.$emit("update-coupon",s.tempCoupon))},{default:x(({errors:_})=>[e("div",S,[e("div",q,[j,a(c,{name:"標題",type:"text",class:v(["form-control",{"is-invalid":_.標題}]),id:"title",modelValue:s.tempCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=t=>s.tempCoupon.title=t),rules:"required",placeholder:"請輸入標題"},null,8,["modelValue","class"]),a(u,{name:"標題",class:"invalid-feedback"})]),e("div",H,[R,a(c,{name:"優惠碼",type:"text",class:v(["form-control",{"is-invalid":_.優惠碼}]),id:"coupon_code",modelValue:s.tempCoupon.code,"onUpdate:modelValue":o[1]||(o[1]=t=>s.tempCoupon.code=t),rules:"required",placeholder:"請輸入優惠碼"},null,8,["modelValue","class"]),a(u,{name:"優惠碼",class:"invalid-feedback"})]),e("div",z,[G,y(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=t=>s.due_date=t)},null,512),[[k,s.due_date]])]),e("div",J,[K,a(c,{name:"折扣百分比",type:"number",class:v(["form-control",{"is-invalid":_.折扣百分比}]),id:"price",min:"0",max:"100",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":o[3]||(o[3]=t=>s.tempCoupon.percent=t),modelModifiers:{number:!0},rules:"required|min_value:0|max_value:100|numeric|integer",placeholder:"請輸入折扣百分比"},null,8,["modelValue","class"]),a(u,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",Q,[e("div",W,[y(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=t=>s.tempCoupon.is_enabled=t),id:"is_enabled"},null,512),[[D,s.tempCoupon.is_enabled]]),X])])]),e("div",Y,[Z,e("button",{type:"submit",class:"btn btn-dark",disabled:i.isProcessing},[i.isProcessing?(r(),p("span",oe)):L("",!0),M(" "+h(i.isNew?"新增優惠卷":"更新優惠券"),1)],8,ee)])]),_:1},512)])])],512)}const te=$(A,[["render",se]]),ne={props:{coupon:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{}}},mixins:[P]},ie={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},le={class:"modal-dialog"},ae={class:"modal-content border-0"},de=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除優惠卷")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ce={class:"modal-body"},ue={class:"text-danger"},re={class:"modal-footer"},pe=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),me=["disabled"];function _e(n,o,i,l,s,d){return r(),p("div",ie,[e("div",le,[e("div",ae,[de,e("div",ce,[M(" 是否刪除 "),e("strong",ue,h(i.coupon.title),1),M(" 優惠卷(刪除後將無法恢復)。 ")]),e("div",re,[pe,e("button",{type:"button",class:"btn btn-danger",disabled:i.isProcessing,onClick:o[0]||(o[0]=c=>n.$emit("del-coupon"))}," 確認刪除 ",8,me)])])])],512)}const he=$(ne,[["render",_e]]),{VITE_API:f,VITE_PATH:g}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/11th_street_cafe/",MODE:"production",DEV:!1,PROD:!0},be={data(){return{coupons:[],tempCoupon:{},couponDate:"",pagination:{},isNew:!1,isLoading:!1,isProcessing:!1}},components:{AdminPagination:V,CouponModal:te,DelCouponModal:he},methods:{getCoupons(n=1){this.isLoading=!0,this.$http.get(`${f}/api/${g}/admin/coupons?page=${n}`).then(o=>{const{coupons:i,pagination:l}=o.data;this.isLoading=!1,this.coupons=i,this.pagination=l}).catch(o=>{var l,s;const i=((s=(l=o.response)==null?void 0:l.data)==null?void 0:s.message)||"資料錯誤，稍後在試";this.isLoading=!1,b.fire({title:`${i}`,icon:"error"})})},openModal(n,o){n==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.$refs.couponModal.showModal()):n==="edit"?(this.isNew=!1,this.tempCoupon={...o},this.$refs.couponModal.showModal()):n==="del"&&(this.tempCoupon={...o},this.$refs.delCouponModal.showModal())},updateCoupon(n){let o=n,i="post",l=`${f}/api/${g}/admin/coupon`;this.isNew||(i="put",l=`${f}/api/${g}/admin/coupon/${this.tempCoupon.id}`,o=this.tempCoupon),this.isProcessing=!0,this.$http[i](l,{data:o}).then(s=>{b.fire({title:`${s.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.couponModal.hideModal(),this.getCoupons()}).catch(s=>{var c,u;this.isProcessing=!1;const d=((u=(c=s.response)==null?void 0:c.data)==null?void 0:u.message)||"資料錯誤";b.fire({title:`${d}`,icon:"error"})})},delCoupon(){this.isProcessing=!0,this.$http.delete(`${f}/api/${g}/admin/coupon/${this.tempCoupon.id}`).then(n=>{b.fire({title:`${n.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.delCouponModal.hideModal(),this.getCoupons()}).catch(n=>{var i,l;this.isProcessing=!1;const o=((l=(i=n.response)==null?void 0:i.data)==null?void 0:l.message)||"資料錯誤";b.fire({title:`${o}`,icon:"error"})})}},mounted(){this.getCoupons()}},fe={class:"text-end mt-4"},ge=["disabled"],Ce={class:"table-responsive-lg"},ve={class:"table mt-4"},Me=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),$e={key:0,class:"text-success"},ye={key:1,class:"text-muted"},Pe={class:"btn-group"},we=["onClick"],Ve=["onClick"];function xe(n,o,i,l,s,d){const c=m("VueLoading"),u=m("AdminPagination"),C=m("CouponModal"),_=m("DelCouponModal");return r(),p("div",null,[a(c,{active:s.isLoading,"onUpdate:active":o[0]||(o[0]=t=>s.isLoading=t)},null,8,["active"]),e("div",fe,[e("button",{class:"btn btn-dark",type:"button",disabled:s.isProcessing,onClick:o[1]||(o[1]=t=>d.openModal("new"))}," 建立新的優惠券 ",8,ge)]),e("div",Ce,[e("table",ve,[Me,e("tbody",null,[(r(!0),p(T,null,N(s.coupons,t=>(r(),p("tr",{key:t.id},[e("td",null,h(t.title),1),e("td",null,h(t.percent)+"%",1),e("td",null,h(n.$filters.date(t.due_date)),1),e("td",null,[t.is_enabled===1?(r(),p("span",$e,"啟用")):(r(),p("span",ye,"未啟用"))]),e("td",null,[e("div",Pe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>d.openModal("edit",t)}," 編輯 ",8,we),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>d.openModal("del",t)}," 刪除 ",8,Ve)])])]))),128))])]),a(u,{pages:s.pagination,onChangePage:d.getCoupons},null,8,["pages","onChangePage"]),a(C,{ref:"couponModal",coupon:s.tempCoupon,"is-new":s.isNew,"is-processing":s.isProcessing,onUpdateCoupon:d.updateCoupon},null,8,["coupon","is-new","is-processing","onUpdateCoupon"]),a(_,{ref:"delCouponModal",coupon:s.tempCoupon,"is-processing":s.isProcessing,onDelCoupon:d.delCoupon},null,8,["coupon","is-processing","onDelCoupon"])])])}const Ne=$(be,[["render",xe]]);export{Ne as default};
