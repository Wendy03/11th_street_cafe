import{m as x,A as V}from"./modalMixin-4066d2fc.js";import{C}from"./ckeditor-e06af751.js";import{_ as M,r as A,o as r,c as d,a as t,t as _,k as m,v as h,F as w,p as $,e as L,b as v,z as U,d as P}from"./index-f76f9e83.js";import{T as u}from"./Toast-87810d29.js";const D={props:{article:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!0},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{},tempArticle:{tag:[""]},create_at:0,editor:C,editorConfig:{toolbar:{items:["heading","bold","italic","link","undo","redo","|"]}}}},mixins:[x],watch:{article(){this.tempArticle={...this.article,tag:this.article.tag||[],isPublic:this.article.isPublic||!1},[this.create_at]=new Date(this.tempArticle.create_at*1e3).toISOString().split("T")},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}}},N={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog modal-xl",role:"document"},E={class:"modal-content border-0"},B={class:"modal-header bg-black text-white"},I={class:"modal-title",id:"exampleModalLabel"},O=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),S={class:"modal-body"},j={class:"row"},F={class:"col-sm-4"},H={class:"mb-3"},R=t("label",{for:"title",class:"form-label"},"標題",-1),z={class:"mb-3"},q=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),G={class:"mb-3"},J=t("label",{for:"author",class:"form-label"},"作者",-1),K={class:"mb-3"},Q=t("label",{for:"create_at"},"文章建立日期",-1),W={class:"col-sm-8"},X=t("label",{for:"tag",class:"form-label"},"標籤",-1),Y={class:"row gx-1 mb-3"},Z={class:"input-group input-group-sm"},tt=["onUpdate:modelValue"],et=["onClick"],st=t("i",{class:"bi bi-x"},null,-1),it=[st],lt={key:0,class:"col-md-2 mb-1"},ot={class:"mb-3"},nt=t("label",{for:"description",class:"form-label"},"文章描述",-1),at={class:"mb-3"},ct=t("p",null,"文章內容",-1),rt={class:"mb-3"},dt={class:"form-check"},pt=t("label",{class:"form-check-label",for:"isPublic"}," 是否公開 ",-1),mt={class:"modal-footer"},ht=t("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),ut=["disabled"];function _t(l,s,i,n,e,a){const p=A("ckeditor");return r(),d("div",N,[t("div",T,[t("div",E,[t("div",B,[t("h5",I,[t("span",null,_(i.isNew?"新增貼文":"編輯貼文"),1)]),O]),t("div",S,[t("div",j,[t("div",F,[t("div",H,[R,m(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":s[0]||(s[0]=o=>e.tempArticle.title=o),placeholder:"請輸入標題"},null,512),[[h,e.tempArticle.title]])]),t("div",z,[q,m(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":s[1]||(s[1]=o=>e.tempArticle.imageUrl=o),placeholder:"請輸入圖片連結"},null,512),[[h,e.tempArticle.imageUrl]])]),t("div",G,[J,m(t("input",{type:"text",class:"form-control",id:"author","onUpdate:modelValue":s[2]||(s[2]=o=>e.tempArticle.author=o),placeholder:"請輸入標題"},null,512),[[h,e.tempArticle.author]])]),t("div",K,[Q,m(t("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":s[3]||(s[3]=o=>e.create_at=o)},null,512),[[h,e.create_at]])])]),t("div",W,[X,t("div",Y,[(r(!0),d(w,null,$(e.tempArticle.tag,(o,b)=>(r(),d("div",{class:"col-md-2 mb-1",key:`${o}tag`},[t("div",Z,[m(t("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":y=>e.tempArticle.tag[b]=y,placeholder:"請輸入標籤"},null,8,tt),[[h,e.tempArticle.tag[b]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:y=>e.tempArticle.tag.splice(b,1)},it,8,et)])]))),128)),e.tempArticle.tag[e.tempArticle.tag.length-1]||!e.tempArticle.tag.length?(r(),d("div",lt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:s[4]||(s[4]=o=>e.tempArticle.tag.push(""))}," 新增標籤 ")])):L("",!0)]),t("div",ot,[nt,m(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[5]||(s[5]=o=>e.tempArticle.description=o),placeholder:"請輸入文章描述"},null,512),[[h,e.tempArticle.description]])]),t("div",at,[ct,v(p,{editor:e.editor,config:e.editorConfig,modelValue:e.tempArticle.content,"onUpdate:modelValue":s[6]||(s[6]=o=>e.tempArticle.content=o)},null,8,["editor","config","modelValue"])]),t("div",rt,[t("div",dt,[m(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=o=>e.tempArticle.isPublic=o),id:"isPublic"},null,512),[[U,e.tempArticle.isPublic]]),pt])])])])]),t("div",mt,[ht,t("button",{type:"button",class:"btn btn-dark",disabled:i.isProcessing,onClick:s[8]||(s[8]=o=>l.$emit("update-article",e.tempArticle))}," 確認 ",8,ut)])])])],512)}const bt=M(D,[["render",_t]]),gt={props:{article:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{}}},mixins:[x]},ft={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},At={class:"modal-dialog"},vt={class:"modal-content border-0"},yt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除文章")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Mt={class:"modal-body"},Pt={class:"text-danger"},xt={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),$t=["disabled"];function kt(l,s,i,n,e,a){return r(),d("div",ft,[t("div",At,[t("div",vt,[yt,t("div",Mt,[P(" 是否刪除 "),t("strong",Pt,_(i.article.title),1),P(" (刪除後將無法恢復)。 ")]),t("div",xt,[wt,t("button",{type:"button",class:"btn btn-danger",disabled:i.isProcessing,onClick:s[0]||(s[0]=p=>l.$emit("del-article"))}," 確認刪除 ",8,$t)])])])],512)}const Vt=M(gt,[["render",kt]]),{VITE_API:g,VITE_PATH:f}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/11th_street_cafe/",MODE:"production",DEV:!1,PROD:!0},Ct={data(){return{articles:[],tempArticle:{},pagination:{},isNew:!1,isLoading:!1,isProcessing:!1}},components:{AdminPagination:V,ArticleModal:bt,DelArticleModal:Vt},methods:{getArticles(l=1){this.isLoading=!0,this.$http.get(`${g}/api/${f}/admin/articles?page=${l}`).then(s=>{const{articles:i,pagination:n}=s.data;this.isLoading=!1,this.articles=i,this.pagination=n}).catch(s=>{var n,e;const i=((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||"資料錯誤";this.isLoading=!1,u.fire({title:`${i}`,icon:"error"})})},getArticle(l){const s=`${g}/api/${f}/admin/article/${l}`;this.isLoading=!0,this.$http.get(s).then(i=>{this.isLoading=!1,i.data.success&&(this.openModal("edit",i.data.article),this.isNew=!1)}).catch(i=>{var e,a;const n=((a=(e=i.response)==null?void 0:e.data)==null?void 0:a.message)||"資料錯誤";this.isLoading=!1,u.fire({title:`${n}`,icon:"error"})})},openModal(l,s){l==="new"?(this.isNew=!0,this.tempArticle={isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]},this.$refs.articleModal.showModal()):l==="edit"?(this.tempArticle={...s},this.isNew=!1,this.$refs.articleModal.showModal()):l==="del"&&(this.tempArticle={...s},this.$refs.delArticleModal.showModal())},updateArticle(l){this.tempArticle={...l};let s="post",i=`${g}/api/${f}/admin/article`;this.isNew||(s="put",i=`${g}/api/${f}/admin/article/${this.tempArticle.id}`),this.isProcessing=!0,this.$http[s](i,{data:this.tempArticle}).then(n=>{u.fire({title:`${n.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.articleModal.hideModal(),this.getArticles()}).catch(n=>{var a,p;this.isProcessing=!1;const e=((p=(a=n.response)==null?void 0:a.data)==null?void 0:p.message)||"資料錯誤";u.fire({title:`${e}`,icon:"error"})})},delArticle(){this.isProcessing=!0,this.$http.delete(`${g}/api/${f}/admin/article/${this.tempArticle.id}`).then(l=>{u.fire({title:`${l.data.message}`,icon:"success"}),this.$refs.delArticleModal.hideModal(),this.isProcessing=!1,this.getArticles()}).catch(l=>{var i,n;this.isProcessing=!1;const s=((n=(i=l.response)==null?void 0:i.data)==null?void 0:n.message)||"資料錯誤";u.fire({title:`${s}`,icon:"error"})})}},mounted(){this.getArticles()}},Lt={class:"text-end mt-4"},Ut=["disabled"],Dt={class:"table-responsive-lg"},Nt={class:"table mt-4"},Tt=t("thead",null,[t("tr",null,[t("th",{style:{width:"200px"}},"標題"),t("th",{style:{width:"200px"}},"作者"),t("th",null,"描述"),t("th",{style:{width:"100px"}},"建立時間"),t("th",{style:{width:"100px"}},"是否公開"),t("th",{style:{width:"120px"}},"編輯")])],-1),Et={key:0},Bt={key:1},It={class:"btn-group"},Ot=["disabled","onClick"],St=["onClick"];function jt(l,s,i,n,e,a){const p=A("VueLoading"),o=A("AdminPagination"),b=A("ArticleModal"),y=A("DelArticleModal");return r(),d("div",null,[v(p,{active:e.isLoading,"onUpdate:active":s[0]||(s[0]=c=>e.isLoading=c)},null,8,["active"]),t("div",Lt,[t("button",{class:"btn btn-dark",type:"button",disabled:e.isProcessing,onClick:s[1]||(s[1]=c=>a.openModal("new"))}," 建立新文章 ",8,Ut)]),t("div",Dt,[t("table",Nt,[Tt,t("tbody",null,[(r(!0),d(w,null,$(e.articles,c=>(r(),d("tr",{key:c.id},[t("td",null,_(c.title),1),t("td",null,_(c.author),1),t("td",null,_(c.description),1),t("td",null,_(l.$filters.date(c.create_at)),1),t("td",null,[c.isPublic?(r(),d("span",Et,"已上架")):(r(),d("span",Bt,"未上架"))]),t("td",null,[t("div",It,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",disabled:e.isProcessing,onClick:k=>a.getArticle(c.id)}," 編輯 ",8,Ot),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:k=>a.openModal("del",c)}," 刪除 ",8,St)])])]))),128))])])]),v(o,{pages:e.pagination,onChangePage:a.getArticles},null,8,["pages","onChangePage"]),v(b,{ref:"articleModal",article:e.tempArticle,"is-new":e.isNew,"is-processing":e.isProcessing,onUpdateArticle:a.updateArticle},null,8,["article","is-new","is-processing","onUpdateArticle"]),v(y,{ref:"delArticleModal",article:e.tempArticle,"is-processing":e.isProcessing,onDelArticle:a.delArticle},null,8,["article","is-processing","onDelArticle"])])}const qt=M(Ct,[["render",jt]]);export{qt as default};
