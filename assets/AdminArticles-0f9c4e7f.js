import{m as $,A as U}from"./modalMixin-6d9b06e0.js";import{C as D}from"./ckeditor-3cd54114.js";import{_ as x,r as u,o as d,c as m,a as e,t as _,b as r,w as N,u as P,l as A,v as w,F as C,s as L,e as T,B as E,d as k}from"./index-cdfc31b9.js";import{T as h}from"./Toast-8cca48e2.js";const B={props:{article:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!0},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{},tempArticle:{tag:[""]},create_at:0,editor:D,editorConfig:{toolbar:{items:["heading","bold","italic","link","undo","redo","|"]}}}},mixins:[$],watch:{article(){this.tempArticle={...this.article,tag:this.article.tag||[],isPublic:this.article.isPublic||!1},[this.create_at]=new Date(this.tempArticle.create_at*1e3).toISOString().split("T")},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}}},I={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},F={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},S={class:"modal-header bg-black text-white"},q={class:"modal-title",id:"exampleModalLabel"},j=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},R={class:"row"},z={class:"col-sm-4"},G={class:"mb-3"},J=e("label",{for:"title",class:"form-label"},"標題",-1),K={class:"mb-3"},Q=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),W={class:"mb-3"},X=e("label",{for:"author",class:"form-label"}," 作者 ",-1),Y={class:"mb-3"},Z=e("label",{for:"create_at"},"文章建立日期",-1),ee={class:"col-sm-8"},te=e("label",{for:"tag",class:"form-label"},"標籤",-1),se={class:"row gx-1 mb-3"},ie={class:"input-group input-group-sm"},le=["onUpdate:modelValue"],oe=["onClick"],ae=e("i",{class:"bi bi-x"},null,-1),ne=[ae],ce={key:0,class:"col-md-2 mb-1"},re={class:"mb-3"},de=e("label",{for:"description",class:"form-label"},"文章描述",-1),me={class:"mb-3"},pe=e("p",null,"文章內容",-1),ue={class:"mb-3"},he={class:"form-check"},_e=e("label",{class:"form-check-label",for:"isPublic"}," 是否公開 ",-1),be={class:"modal-footer"},ge=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),fe=["disabled"];function Ae(l,s,i,a,t,c){const p=u("VField"),b=u("ErrorMessage"),v=u("ckeditor"),M=u("VForm");return d(),m("div",I,[e("div",F,[e("div",O,[e("div",S,[e("h5",q,[e("span",null,_(i.isNew?"新增貼文":"編輯貼文"),1)]),j]),r(M,{ref:"form",onSubmit:s[8]||(s[8]=n=>l.$emit("update-article",t.tempArticle))},{default:N(({errors:n})=>[e("div",H,[e("div",R,[e("div",z,[e("div",G,[J,r(p,{type:"text",name:"標題",class:P(["form-control",{"is-invalid":n.標題}]),id:"title",modelValue:t.tempArticle.title,"onUpdate:modelValue":s[0]||(s[0]=o=>t.tempArticle.title=o),rules:"required",placeholder:"請輸入標題"},null,8,["modelValue","class"]),r(b,{name:"標題",class:"invalid-feedback"})]),e("div",K,[Q,r(p,{type:"text",name:"圖片",class:P(["form-control",{"is-invalid":n.圖片}]),id:"image",modelValue:t.tempArticle.imageUrl,"onUpdate:modelValue":s[1]||(s[1]=o=>t.tempArticle.imageUrl=o),rules:"required|url",placeholder:"請輸入圖片連結"},null,8,["modelValue","class"]),r(b,{name:"圖片",class:"invalid-feedback"})]),e("div",W,[X,r(p,{type:"text",name:"作者",class:P(["form-control",{"is-invalid":n.作者}]),id:"author",modelValue:t.tempArticle.author,"onUpdate:modelValue":s[2]||(s[2]=o=>t.tempArticle.author=o),rules:"required",placeholder:"請輸入作者"},null,8,["modelValue","class"]),r(b,{name:"作者",class:"invalid-feedback"})]),e("div",Y,[Z,A(e("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":s[3]||(s[3]=o=>t.create_at=o)},null,512),[[w,t.create_at]])])]),e("div",ee,[te,e("div",se,[(d(!0),m(C,null,L(t.tempArticle.tag,(o,y)=>(d(),m("div",{class:"col-md-2 mb-1",key:`${o}tag`},[e("div",ie,[A(e("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":V=>t.tempArticle.tag[y]=V,placeholder:"請輸入標籤"},null,8,le),[[w,t.tempArticle.tag[y]]]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:V=>t.tempArticle.tag.splice(y,1)},ne,8,oe)])]))),128)),t.tempArticle.tag[t.tempArticle.tag.length-1]||!t.tempArticle.tag.length?(d(),m("div",ce,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:s[4]||(s[4]=o=>t.tempArticle.tag.push(""))}," 新增標籤 ")])):T("",!0)]),e("div",re,[de,A(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[5]||(s[5]=o=>t.tempArticle.description=o),placeholder:"請輸入文章描述"},null,512),[[w,t.tempArticle.description]])]),e("div",me,[pe,r(v,{editor:t.editor,config:t.editorConfig,modelValue:t.tempArticle.content,"onUpdate:modelValue":s[6]||(s[6]=o=>t.tempArticle.content=o)},null,8,["editor","config","modelValue"])]),e("div",ue,[e("div",he,[A(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=o=>t.tempArticle.isPublic=o),id:"isPublic"},null,512),[[E,t.tempArticle.isPublic]]),_e])])])])]),e("div",be,[ge,e("button",{type:"submit",class:"btn btn-dark",disabled:i.isProcessing}," 確認 ",8,fe)])]),_:1},512)])])],512)}const ve=x(B,[["render",Ae]]),Me={props:{article:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{}}},mixins:[$]},ye={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Pe={class:"modal-dialog"},we={class:"modal-content border-0"},xe=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除文章")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ve={class:"modal-body"},ke={class:"text-danger"},$e={class:"modal-footer"},Ce=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),Le=["disabled"];function Ue(l,s,i,a,t,c){return d(),m("div",ye,[e("div",Pe,[e("div",we,[xe,e("div",Ve,[k(" 是否刪除 "),e("strong",ke,_(i.article.title),1),k(" (刪除後將無法恢復)。 ")]),e("div",$e,[Ce,e("button",{type:"button",class:"btn btn-danger",disabled:i.isProcessing,onClick:s[0]||(s[0]=p=>l.$emit("del-article"))}," 確認刪除 ",8,Le)])])])],512)}const De=x(Me,[["render",Ue]]),{VITE_API:g,VITE_PATH:f}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/11th_street_cafe/",MODE:"production",DEV:!1,PROD:!0},Ne={data(){return{articles:[],tempArticle:{},pagination:{},isNew:!1,isLoading:!1,isProcessing:!1}},components:{AdminPagination:U,ArticleModal:ve,DelArticleModal:De},methods:{getArticles(l=1){this.isLoading=!0,this.$http.get(`${g}/api/${f}/admin/articles?page=${l}`).then(s=>{const{articles:i,pagination:a}=s.data;this.isLoading=!1,this.articles=i,this.pagination=a}).catch(s=>{var a,t;const i=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"資料錯誤";this.isLoading=!1,h.fire({title:`${i}`,icon:"error"})})},getArticle(l){const s=`${g}/api/${f}/admin/article/${l}`;this.isLoading=!0,this.$http.get(s).then(i=>{this.isLoading=!1,i.data.success&&(this.openModal("edit",i.data.article),this.isNew=!1)}).catch(i=>{var t,c;const a=((c=(t=i.response)==null?void 0:t.data)==null?void 0:c.message)||"資料錯誤";this.isLoading=!1,h.fire({title:`${a}`,icon:"error"})})},openModal(l,s){l==="new"?(this.isNew=!0,this.tempArticle={isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]},this.$refs.articleModal.showModal()):l==="edit"?(this.tempArticle={...s},this.isNew=!1,this.$refs.articleModal.showModal()):l==="del"&&(this.tempArticle={...s},this.$refs.delArticleModal.showModal())},updateArticle(l){this.tempArticle={...l};let s="post",i=`${g}/api/${f}/admin/article`;this.isNew||(s="put",i=`${g}/api/${f}/admin/article/${this.tempArticle.id}`),this.isProcessing=!0,this.$http[s](i,{data:this.tempArticle}).then(a=>{h.fire({title:`${a.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.articleModal.hideModal(),this.getArticles()}).catch(a=>{var c,p;this.isProcessing=!1;const t=((p=(c=a.response)==null?void 0:c.data)==null?void 0:p.message)||"資料錯誤";h.fire({title:`${t}`,icon:"error"})})},delArticle(){this.isProcessing=!0,this.$http.delete(`${g}/api/${f}/admin/article/${this.tempArticle.id}`).then(l=>{h.fire({title:`${l.data.message}`,icon:"success"}),this.$refs.delArticleModal.hideModal(),this.isProcessing=!1,this.getArticles()}).catch(l=>{var i,a;this.isProcessing=!1;const s=((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"資料錯誤";h.fire({title:`${s}`,icon:"error"})})}},mounted(){this.getArticles()}},Te={class:"text-end mt-4"},Ee=["disabled"],Be={class:"table-responsive-lg"},Ie={class:"table mt-4"},Fe=e("thead",null,[e("tr",null,[e("th",{style:{width:"200px"}},"標題"),e("th",{style:{width:"200px"}},"作者"),e("th",null,"描述"),e("th",{style:{width:"100px"}},"建立時間"),e("th",{style:{width:"100px"}},"是否公開"),e("th",{style:{width:"120px"}},"編輯")])],-1),Oe={key:0},Se={key:1},qe={class:"btn-group"},je=["disabled","onClick"],He=["onClick"];function Re(l,s,i,a,t,c){const p=u("VueLoading"),b=u("AdminPagination"),v=u("ArticleModal"),M=u("DelArticleModal");return d(),m("div",null,[r(p,{active:t.isLoading,"onUpdate:active":s[0]||(s[0]=n=>t.isLoading=n)},null,8,["active"]),e("div",Te,[e("button",{class:"btn btn-dark",type:"button",disabled:t.isProcessing,onClick:s[1]||(s[1]=n=>c.openModal("new"))}," 建立新文章 ",8,Ee)]),e("div",Be,[e("table",Ie,[Fe,e("tbody",null,[(d(!0),m(C,null,L(t.articles,n=>(d(),m("tr",{key:n.id},[e("td",null,_(n.title),1),e("td",null,_(n.author),1),e("td",null,_(n.description),1),e("td",null,_(l.$filters.date(n.create_at)),1),e("td",null,[n.isPublic?(d(),m("span",Oe,"已上架")):(d(),m("span",Se,"未上架"))]),e("td",null,[e("div",qe,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",disabled:t.isProcessing,onClick:o=>c.getArticle(n.id)}," 編輯 ",8,je),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:o=>c.openModal("del",n)}," 刪除 ",8,He)])])]))),128))])])]),r(b,{pages:t.pagination,onChangePage:c.getArticles},null,8,["pages","onChangePage"]),r(v,{ref:"articleModal",article:t.tempArticle,"is-new":t.isNew,"is-processing":t.isProcessing,onUpdateArticle:c.updateArticle},null,8,["article","is-new","is-processing","onUpdateArticle"]),r(M,{ref:"delArticleModal",article:t.tempArticle,"is-processing":t.isProcessing,onDelArticle:c.delArticle},null,8,["article","is-processing","onDelArticle"])])}const Qe=x(Ne,[["render",Re]]);export{Qe as default};
